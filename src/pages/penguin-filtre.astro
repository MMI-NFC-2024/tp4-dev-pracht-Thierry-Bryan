---
import Layout from "../layouts/Layout.astro";
import Menu from "../components/Menu.astro";
---

<Layout>
  <div class="container mx-auto p-8">
    <Menu currentPage="penguin-filtre" />
    
    <h1 class="text-2xl font-bold mb-4 text-center">Manchots avec filtre d'espèce</h1>

    <div class="mb-6 text-center">
      <label for="species" class="mr-2 font-medium">Filtrer par espèce :</label>
      <select name="species" id="species" class="select select-bordered">
        <option value="">All species</option>
        <option value="Adelie">Adelie</option>
        <option value="Chinstrap">Chinstrap</option>
        <option value="Gentoo">Gentoo</option>
      </select>
    </div>

    <div id="myplot" class="flex justify-center"></div>

    <script>
      import * as Plot from "@observablehq/plot";
      import penguins from "../assets/penguins.json";

      // Récupère l'élément select pour choisir l'espèce
      const selectSpecies = document.getElementById("species");

      function renderPlot() {
        // Récupère l'espèce sélectionnée
        const species = selectSpecies.value;

        // Sélectionne la div où le graphique sera affiché
        const div = document.getElementById("myplot");

        // Vide le contenu précédent de la div
        if (div) div.innerHTML = "";

        // Filtre les données selon l'espèce sélectionnée
        const filteredPenguins = species
          ? penguins.filter((p) => p.species === species)
          : penguins;

        // Crée le graphique avec Plot
        const plot = Plot.plot({
          marks: [
            // Ajoute les points du graphique, filtrés selon l'espèce choisie
            Plot.dot(filteredPenguins, {
              x: "culmen_length_mm", // Axe X : longueur du bec
              y: "culmen_depth_mm", // Axe Y : profondeur du bec
              stroke: "species", // Couleur selon l'espèce
            }),
          ],
        });
        // Ajoute le graphique à la div
        if (div) div.append(plot);
      }

      // Ajoute un écouteur d'événement pour le changement d'espèce (appel 'renderPlot')
      if (selectSpecies) selectSpecies.addEventListener("change", renderPlot);

      // Affiche le graphique au chargement de la page
      renderPlot();
    </script>
  </div>
</Layout>
